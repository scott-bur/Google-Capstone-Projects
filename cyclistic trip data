/*
     Google Case Study: How Does a Bike-Share Navigate Speedy Success?
     Scott Burden
     December 2022
*/

CREATE SCHEMA cyclistic;
USE cyclistic;

-- create december 2021 table
DROP TABLE IF EXISTS december_2021;
CREATE TABLE december_2021 (
    ride_id VARCHAR(20),
    rideable_type VARCHAR(20),
    started_at DATETIME,
    ended_at DATETIME,
    start_station_name VARCHAR(100),
    start_station_id VARCHAR(100),
    end_station_name VARCHAR(100),
    end_station_id VARCHAR(100),
    start_lat FLOAT,
    start_lng FLOAT,
    end_lat FLOAT,
    end_lng FLOAT,
    member_casual VARCHAR(20),
    ride_length TIME,
    day_of_week INT
);

-- import csv file for december 2021   
LOAD DATA LOCAL INFILE '/Users/scottbur/projects/Trip Data/202112_tripdata.csv'
INTO TABLE december_2021
FIELDS TERMINATED BY ',' ENCLOSED BY '"'
LINES TERMINATED BY '\r\n'
IGNORE 1 LINES;
 
-- create january 2022 table 
DROP TABLE IF EXISTS january_2022;
CREATE TABLE january_2022 (
    ride_id VARCHAR(20),
    rideable_type VARCHAR(20),
    started_at DATETIME,
    ended_at DATETIME,
    start_station_name VARCHAR(100),
    start_station_id VARCHAR(100),
    end_station_name VARCHAR(100),
    end_station_id VARCHAR(100),
    start_lat FLOAT,
    start_lng FLOAT,
    end_lat FLOAT,
    end_lng FLOAT,
    member_casual VARCHAR(20),
    ride_length TIME,
    day_of_week INT
);

-- import csv file for january 2022
LOAD DATA LOCAL INFILE '/Users/scottbur/projects/Trip Data/202201_tripdata.csv'
INTO TABLE january_2022
FIELDS TERMINATED BY ',' ENCLOSED BY '"'
LINES TERMINATED BY '\r\n'
IGNORE 1 LINES;

-- create february 2022 table
DROP TABLE IF EXISTS february_2022;
CREATE TABLE february_2022 (
    ride_id VARCHAR(20),
    rideable_type VARCHAR(20),
    started_at DATETIME,
    ended_at DATETIME,
    start_station_name VARCHAR(100),
    start_station_id VARCHAR(100),
    end_station_name VARCHAR(100),
    end_station_id VARCHAR(100),
    start_lat FLOAT,
    start_lng FLOAT,
    end_lat FLOAT,
    end_lng FLOAT,
    member_casual VARCHAR(20),
    ride_length TIME,
    day_of_week INT
);

-- import csv file for february 2022
LOAD DATA LOCAL INFILE '/Users/scottbur/projects/Trip Data/202202_tripdata.csv'
INTO TABLE february_2022
FIELDS TERMINATED BY ',' ENCLOSED BY '"'
LINES TERMINATED BY '\r\n'
IGNORE 1 LINES;

-- create march 2022 table 
DROP TABLE IF EXISTS march_2022;
CREATE TABLE march_2022 (
    ride_id VARCHAR(20),
    rideable_type VARCHAR(20),
    started_at DATETIME,
    ended_at DATETIME,
    start_station_name VARCHAR(100),
    start_station_id VARCHAR(100),
    end_station_name VARCHAR(100),
    end_station_id VARCHAR(100),
    start_lat FLOAT,
    start_lng FLOAT,
    end_lat FLOAT,
    end_lng FLOAT,
    member_casual VARCHAR(20),
    ride_length TIME,
    day_of_week INT
);
   
-- import csv file for march 2022
LOAD DATA LOCAL INFILE '/Users/scottbur/projects/Trip Data/202203_tripdata.csv'
INTO TABLE march_2022
FIELDS TERMINATED BY ',' ENCLOSED BY '"'
LINES TERMINATED BY '\r\n'
IGNORE 1 LINES;

-- create april 2022 table 
DROP TABLE IF EXISTS april_2022;
CREATE TABLE april_2022 (
    ride_id VARCHAR(20),
    rideable_type VARCHAR(20),
    started_at DATETIME,
    ended_at DATETIME,
    start_station_name VARCHAR(100),
    start_station_id VARCHAR(100),
    end_station_name VARCHAR(100),
    end_station_id VARCHAR(100),
    start_lat FLOAT,
    start_lng FLOAT,
    end_lat FLOAT,
    end_lng FLOAT,
    member_casual VARCHAR(20),
    ride_length TIME,
    day_of_week INT
);

-- import csv file for april 2022
LOAD DATA LOCAL INFILE '/Users/scottbur/projects/Trip Data/202204_tripdata.csv'
INTO TABLE april_2022
FIELDS TERMINATED BY ',' ENCLOSED BY '"'
LINES TERMINATED BY '\r\n'
IGNORE 1 LINES;

-- create may 2022 table 
DROP TABLE IF EXISTS may_2022;
CREATE TABLE may_2022 (
    ride_id VARCHAR(20),
    rideable_type VARCHAR(20),
    started_at DATETIME,
    ended_at DATETIME,
    start_station_name VARCHAR(100),
    start_station_id VARCHAR(100),
    end_station_name VARCHAR(100),
    end_station_id VARCHAR(100),
    start_lat FLOAT,
    start_lng FLOAT,
    end_lat FLOAT,
    end_lng FLOAT,
    member_casual VARCHAR(20),
    ride_length TIME,
    day_of_week INT
);

-- import csv file for may 2022
LOAD DATA LOCAL INFILE '/Users/scottbur/projects/Trip Data/202205_tripdata.csv'
INTO TABLE may_2022
FIELDS TERMINATED BY ',' ENCLOSED BY '"'
LINES TERMINATED BY '\r\n'
IGNORE 1 LINES;

-- create june 2022 table 
DROP TABLE IF EXISTS june_2022;
CREATE TABLE june_2022 (
    ride_id VARCHAR(20),
    rideable_type VARCHAR(20),
    started_at DATETIME,
    ended_at DATETIME,
    start_station_name VARCHAR(100),
    start_station_id VARCHAR(100),
    end_station_name VARCHAR(100),
    end_station_id VARCHAR(100),
    start_lat FLOAT,
    start_lng FLOAT,
    end_lat FLOAT,
    end_lng FLOAT,
    member_casual VARCHAR(20),
    ride_length TIME,
    day_of_week INT
);

-- import csv file for june 2022    
LOAD DATA LOCAL INFILE '/Users/scottbur/projects/Trip Data/202206_tripdata.csv'
INTO TABLE june_2022
FIELDS TERMINATED BY ',' ENCLOSED BY '"'
LINES TERMINATED BY '\r\n'
IGNORE 1 LINES;

-- create july 2022 table 
DROP TABLE IF EXISTS july_2022;
CREATE TABLE july_2022 (
    ride_id VARCHAR(20),
    rideable_type VARCHAR(20),
    started_at DATETIME,
    ended_at DATETIME,
    start_station_name VARCHAR(100),
    start_station_id VARCHAR(100),
    end_station_name VARCHAR(100),
    end_station_id VARCHAR(100),
    start_lat FLOAT,
    start_lng FLOAT,
    end_lat FLOAT,
    end_lng FLOAT,
    member_casual VARCHAR(20),
    ride_length TIME,
    day_of_week INT
);

-- import csv file for july 2022
LOAD DATA LOCAL INFILE '/Users/scottbur/projects/Trip Data/202207_tripdata.csv'
INTO TABLE july_2022
FIELDS TERMINATED BY ',' ENCLOSED BY '"'
LINES TERMINATED BY '\r\n'
IGNORE 1 LINES;

-- create august 2022 table 
DROP TABLE IF EXISTS august_2022;
CREATE TABLE august_2022 (
    ride_id VARCHAR(20),
    rideable_type VARCHAR(20),
    started_at DATETIME,
    ended_at DATETIME,
    start_station_name VARCHAR(100),
    start_station_id VARCHAR(100),
    end_station_name VARCHAR(100),
    end_station_id VARCHAR(100),
    start_lat FLOAT,
    start_lng FLOAT,
    end_lat FLOAT,
    end_lng FLOAT,
    member_casual VARCHAR(20),
    ride_length TIME,
    day_of_week INT
);

-- import csv file for august 2022
LOAD DATA LOCAL INFILE '/Users/scottbur/projects/Trip Data/202208_tripdata.csv'
INTO TABLE august_2022
FIELDS TERMINATED BY ',' ENCLOSED BY '"'
LINES TERMINATED BY '\r\n'
IGNORE 1 LINES;

-- create september 2022 table 
DROP TABLE IF EXISTS september_2022;
CREATE TABLE september_2022 (
    ride_id VARCHAR(20),
    rideable_type VARCHAR(20),
    started_at DATETIME,
    ended_at DATETIME,
    start_station_name VARCHAR(100),
    start_station_id VARCHAR(100),
    end_station_name VARCHAR(100),
    end_station_id VARCHAR(100),
    start_lat FLOAT,
    start_lng FLOAT,
    end_lat FLOAT,
    end_lng FLOAT,
    member_casual VARCHAR(20),
    ride_length TIME,
    day_of_week INT
);

-- import csv file for september 2022
LOAD DATA LOCAL INFILE '/Users/scottbur/projects/Trip Data/202209_tripdata.csv'
INTO TABLE september_2022
FIELDS TERMINATED BY ',' ENCLOSED BY '"'
LINES TERMINATED BY '\r\n'
IGNORE 1 LINES;

-- create october 2022 table 
DROP TABLE IF EXISTS october_2022;
CREATE TABLE october_2022 (
    ride_id VARCHAR(20),
    rideable_type VARCHAR(20),
    started_at DATETIME,
    ended_at DATETIME,
    start_station_name VARCHAR(100),
    start_station_id VARCHAR(100),
    end_station_name VARCHAR(100),
    end_station_id VARCHAR(100),
    start_lat FLOAT,
    start_lng FLOAT,
    end_lat FLOAT,
    end_lng FLOAT,
    member_casual VARCHAR(20),
    ride_length TIME,
    day_of_week INT
);

-- import csv file for october 2022
LOAD DATA LOCAL INFILE '/Users/scottbur/projects/Trip Data/202210_tripdata.csv'
INTO TABLE october_2022
FIELDS TERMINATED BY ',' ENCLOSED BY '"'
LINES TERMINATED BY '\r\n'
IGNORE 1 LINES;

-- create november 2022 table 
DROP TABLE IF EXISTS november_2022;
CREATE TABLE november_2022 (
    ride_id VARCHAR(20),
    rideable_type VARCHAR(20),
    started_at DATETIME,
    ended_at DATETIME,
    start_station_name VARCHAR(100),
    start_station_id VARCHAR(100),
    end_station_name VARCHAR(100),
    end_station_id VARCHAR(100),
    start_lat FLOAT,
    start_lng FLOAT,
    end_lat FLOAT,
    end_lng FLOAT,
    member_casual VARCHAR(20),
    ride_length TIME,
    day_of_week INT
);

-- import csv file for november 2022
LOAD DATA LOCAL INFILE '/Users/scottbur/projects/Trip Data/202211_tripdata.csv'
INTO TABLE november_2022
FIELDS TERMINATED BY ',' ENCLOSED BY '"'
LINES TERMINATED BY '\r\n'
IGNORE 1 LINES;

-- create combined trip data table 
DROP TABLE IF EXISTS trip_data;
CREATE TABLE trip_data (
    ride_id VARCHAR(20),
    rideable_type VARCHAR(20),
    started_at DATETIME,
    ended_at DATETIME,
    start_station_name VARCHAR(100),
    start_station_id VARCHAR(100),
    end_station_name VARCHAR(100),
    end_station_id VARCHAR(100),
    start_lat FLOAT,
    start_lng FLOAT,
    end_lat FLOAT,
    end_lng FLOAT,
    member_casual VARCHAR(20),
    ride_length TIME,
    day_of_week INT
);

-- combine all tables into combined trip data table 
INSERT INTO trip_data
SELECT
	ride_id, rideable_type, started_at, ended_at, start_station_name, 
    start_station_id, end_station_name, end_station_id, start_lat, start_lng, end_lat, end_lng,
    member_casual, ride_length, day_of_week
FROM december_2021
UNION
SELECT
	ride_id, rideable_type, started_at, ended_at, start_station_name,
    start_station_id, end_station_name, end_station_id, start_lat, start_lng, end_lat, end_lng,
    member_casual, ride_length, day_of_week
FROM january_2022
UNION
SELECT
	ride_id, rideable_type, started_at, ended_at, start_station_name,
    start_station_id, end_station_name, end_station_id, start_lat, start_lng, end_lat, end_lng,
    member_casual, ride_length, day_of_week
FROM february_2022
UNION
SELECT
	ride_id, rideable_type, started_at, ended_at, start_station_name,
    start_station_id, end_station_name, end_station_id, start_lat, start_lng, end_lat, end_lng,
    member_casual, ride_length, day_of_week
FROM march_2022
UNION
SELECT
	ride_id, rideable_type, started_at, ended_at, start_station_name,
    start_station_id, end_station_name, end_station_id, start_lat, start_lng, end_lat, end_lng,
    member_casual, ride_length, day_of_week
FROM april_2022
UNION
SELECT
	ride_id, rideable_type, started_at, ended_at, start_station_name,
    start_station_id, end_station_name, end_station_id, start_lat, start_lng, end_lat, end_lng,
    member_casual, ride_length, day_of_week
FROM may_2022
UNION
SELECT
	ride_id, rideable_type, started_at, ended_at, start_station_name,
    start_station_id, end_station_name, end_station_id, start_lat, start_lng, end_lat, end_lng,
    member_casual, ride_length, day_of_week
FROM june_2022
UNION
SELECT
	ride_id, rideable_type, started_at, ended_at, start_station_name,
    start_station_id, end_station_name, end_station_id, start_lat, start_lng, end_lat, end_lng,
    member_casual, ride_length, day_of_week
FROM july_2022
UNION
SELECT
	ride_id, rideable_type, started_at, ended_at, start_station_name,
    start_station_id, end_station_name, end_station_id, start_lat, start_lng, end_lat, end_lng,
    member_casual, ride_length, day_of_week
FROM august_2022
UNION
SELECT
	ride_id, rideable_type, started_at, ended_at, start_station_name,
    start_station_id, end_station_name, end_station_id, start_lat, start_lng, end_lat, end_lng,
    member_casual, ride_length, day_of_week
FROM september_2022
UNION
SELECT
	ride_id, rideable_type, started_at, ended_at, start_station_name,
    start_station_id, end_station_name, end_station_id, start_lat, start_lng, end_lat, end_lng,
    member_casual, ride_length, day_of_week
FROM october_2022
UNION
SELECT
	ride_id, rideable_type, started_at, ended_at, start_station_name,
    start_station_id, end_station_name, end_station_id, start_lat, start_lng, end_lat, end_lng,
    member_casual, ride_length, day_of_week
FROM november_2022
;


-- Count number of records 
SELECT COUNT(*) FROM trip_data;
# 5,733,451 bike-share records

-- Check for distinct values
SELECT DISTINCT rideable_type
FROM trip_data;
# classic_bike, electric_bike, docked_bike

-- Check for distinct values
SELECT DISTINCT member_casual
FROM trip_data;
# member, casual

-- Delete rows that do not fit in our ride definition
DELETE FROM trip_data
WHERE TIMESTAMPDIFF(MINUTE,started_at,ended_at) < 1;
# 27840 row(s) affected

DELETE FROM trip_data 
WHERE TIMESTAMPDIFF(HOUR,started_at, ended_at) >= 24;
# 11663 row(s) affected

-- Count total records after deletion
SELECT COUNT(*) FROM trip_data;
# 5,693,948 bike-share records

